<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¡¼åŒä½ç´  pH è®¡è®¡ç®—å™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        /* CSS æ ·å¼ä¿æŒä¸å˜ï¼Œå› ä¸ºæ‚¨å¯¹æ¿å¼è®¾è®¡æ»¡æ„ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #eef4f8; 
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        .container {
            width: 100%;
            max-width: 1200px;
            background: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
        }
        h1 {
            color: #1a5a9c;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }
        
        /* è¾“å…¥å’Œæ§åˆ¶åŒºåŸŸ */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: end;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
            background-color: #f6f9fc;
            border: 1px solid #e0e6ed;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
            font-size: 0.95em;
        }
        .input-group input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #c8d3e6;
            border-radius: 6px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        .input-group input[type="number"]:focus {
            border-color: #1a5a9c;
            box-shadow: 0 0 0 2px rgba(26, 90, 156, 0.2);
            outline: none;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        #calcButton {
            grid-column: span 1;
            padding: 12px 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.1s;
        }
        
        @media (max-width: 900px) {
            .input-grid { grid-template-columns: repeat(2, 1fr); }
            #calcButton { grid-column: span 2; }
        }
        @media (max-width: 600px) {
            .input-grid { grid-template-columns: 1fr; }
            #calcButton { grid-column: span 1; }
        }

        #calcButton:hover {
            background-color: #1e7e34;
            transform: translateY(-1px);
        }

        /* å›¾è¡¨å®¹å™¨ - è§£å†³ç”»å¹…è¿‡é•¿é—®é¢˜ */
        .chart-container {
            position: relative;
            width: 100%;
            height: 500px;
            margin-bottom: 30px;
            box-sizing: border-box;
        }
        #boronChart {
            width: 100% !important;
            height: 100% !important;
        }

        /* ç»“æœåŒºåŸŸ */
        .results {
            padding: 20px;
            border-radius: 8px;
            background-color: #e8f7ec;
            border-left: 5px solid #28a745;
        }
        .results h3 {
            color: #1a5a9c;
            margin-top: 0;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 10px;
        }
        .results p {
            margin: 8px 0;
            font-size: 1.1em;
        }
        .results strong {
            color: #d9534f;
            font-size: 1.2em;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ”¬ ç¡¼åŒä½ç´ å¹³è¡¡è®¡ç®—ä¸å¯è§†åŒ–</h1>

    <div class="input-grid">
        <div class="input-group">
            <label for="pKB">ç¡¼é…¸è§£ç¦»å¸¸æ•° pK<sub>B</sub>*:</label>
            <input type="number" id="pKB" value="8.597" step="0.001">
        </div>
        <div class="input-group">
            <label for="alpha">åˆ†é¦å› å­ Î± (Bâ‚„/Bâ‚ƒ):</label>
            <input type="number" id="alpha" value="0.97352" step="0.00001">
        </div>
        <div class="input-group">
            <label for="d11B_sw">æº¶æ¶²æ€» Î´Â¹Â¹B (â€°):</label>
            <input type="number" id="d11B_sw" value="39.6" step="0.1">
        </div>
        <div class="input-group">
            <label for="target_pH">ç›®æ ‡ pH å€¼:</label>
            <input type="number" id="target_pH" value="8.1" step="0.01">
        </div>
        <button id="calcButton" onclick="updateChartAndResults()">è®¡ç®—å¹¶ç»˜å›¾</button>
    </div>

    <div class="chart-container">
        <canvas id="boronChart"></canvas>
    </div>

    <div class="results">
        <h3>ğŸ¯ ç›®æ ‡ç‚¹ (pH = <span id="output_pH">8.10</span>) å¤„çš„åŒä½ç´ ç»„æˆ:</h3>
        <p>ç¡¼é…¸ (B(OH)â‚ƒ, Î´Â¹Â¹Bâ‚ƒ): <strong id="d11B_3_result">ç­‰å¾…è®¡ç®—...</strong> â€°</p>
        <p>ç¡¼é…¸æ ¹ (B(OH)â‚„â», Î´Â¹Â¹Bâ‚„): <strong id="d11B_4_result">ç­‰å¾…è®¡ç®—...</strong> â€°</p>
    </div>
</div>

<script>
    // **å…³é”®ä¿®æ”¹ï¼šä¸å†æ³¨å†Œ ChartDataLabels æ’ä»¶**

    let boronChart;
    
    // --- æ ¸å¿ƒè®¡ç®—å‡½æ•° ---
    function calculateBoron(pH, pKB, d11B_sw, alpha) {
        const f_B4 = 1 / (1 + Math.pow(10, (pKB - pH)));
        const epsilon = 1000 * (alpha - 1); 
        const d11B_3 = d11B_sw - f_B4 * epsilon;
        const d11B_4 = d11B_3 + epsilon;

        return { d11B_3, d11B_4 };
    }

    // --- ç”Ÿæˆæ›²çº¿æ•°æ® ({x, y} æ ¼å¼) ---
    function generateCurveData(pKB, d11B_sw, alpha) {
        const d11B_3_data = [];
        const d11B_4_data = [];
        const d11B_sw_line = [];
        
        for (let pH = 7.0; pH <= 10.0; pH += 0.05) {
            const pH_fixed = parseFloat(pH.toFixed(2));
            const result = calculateBoron(pH_fixed, pKB, d11B_sw, alpha);
            
            d11B_3_data.push({ x: pH_fixed, y: result.d11B_3 });
            d11B_4_data.push({ x: pH_fixed, y: result.d11B_4 });
            d11B_sw_line.push({ x: pH_fixed, y: d11B_sw });
        }
        
        return { d11B_3_data, d11B_4_data, d11B_sw_line };
    }

    // --- åˆå§‹åŒ– Chart.js å›¾è¡¨ ---
    function initChart() {
        const ctx = document.getElementById('boronChart').getContext('2d');
        
        const initialData = generateCurveData(
            parseFloat(document.getElementById('pKB').value), 
            parseFloat(document.getElementById('d11B_sw').value), 
            parseFloat(document.getElementById('alpha').value)
        );
        
        boronChart = new Chart(ctx, {
            type: 'line',
            data: {
                datasets: [
                    {
                        label: 'æº¶æ¶²æ€» Î´Â¹Â¹B',
                        data: initialData.d11B_sw_line,
                        borderColor: 'rgba(50, 50, 50, 0.5)',
                        borderWidth: 2,
                        borderDash: [6, 4], 
                        // **å…³é”®ä¿®æ”¹ï¼šè®©æ•°æ®ç‚¹å¯è§ (radius > 0) æ‰èƒ½è§¦å‘ Tooltip**
                        pointRadius: 0, 
                        pointHoverRadius: 6, // æ‚¬åœæ—¶ç‚¹å˜å¤§
                        fill: false,
                        parsing: false,
                    },
                    {
                        label: 'Î´Â¹Â¹Bâ‚ƒ (ç¡¼é…¸)',
                        data: initialData.d11B_3_data,
                        borderColor: '#007bff',
                        borderWidth: 3,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        fill: false,
                        parsing: false,
                    },
                    {
                        label: 'Î´Â¹Â¹Bâ‚„ (ç¡¼é…¸æ ¹)',
                        data: initialData.d11B_4_data,
                        borderColor: '#ff6384',
                        borderWidth: 3,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        fill: false,
                        parsing: false,
                    },
                    // ç›®æ ‡ç‚¹ï¼ˆæ•£ç‚¹å›¾å±‚ï¼‰
                    {
                        label: 'ç›®æ ‡ç‚¹',
                        data: [], 
                        type: 'scatter',
                        backgroundColor: '#28a745', 
                        borderColor: 'white',
                        borderWidth: 2,
                        pointRadius: 8,
                        pointStyle: 'crossRot',
                        pointHoverRadius: 10,
                        // ç›®æ ‡ç‚¹ä¸éœ€è¦ Tooltipï¼Œæˆ‘ä»¬ç›´æ¥åœ¨ç»“æœåŒºæ˜¾ç¤º
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            usePointStyle: true,
                            font: { size: 14 }
                        }
                    },
                    title: {
                        display: true,
                        text: 'ç¡¼åŒä½ç´ ç»„åˆ† Î´Â¹Â¹B éš pH çš„ç†è®ºåˆ†é¦æ›²çº¿',
                        font: { size: 18 }
                    },
                    // **å…³é”®ä¿®æ”¹ï¼šé…ç½® Tooltip ä»¥æ˜¾ç¤ºç²¾ç¡®çš„ pH å’Œ Î´Â¹Â¹B**
                    tooltip: {
                        mode: 'nearest',
                        intersect: false,
                        callbacks: {
                            title: function(context) {
                                // æ˜¾ç¤º pH å€¼ä½œä¸º Tooltip æ ‡é¢˜
                                return 'pH: ' + context[0].parsed.x.toFixed(2);
                            },
                            label: function(context) {
                                // æ˜¾ç¤ºæ›²çº¿æ ‡ç­¾å’Œ Î´Â¹Â¹B å€¼
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += context.parsed.y.toFixed(4) + ' â€°';
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'pH',
                            font: { size: 16, weight: 'bold' }
                        },
                        min: 7.0,
                        max: 10.0,
                        type: 'linear'
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Î´Â¹Â¹B (â€°)',
                            font: { size: 16, weight: 'bold' }
                        },
                        beginAtZero: false 
                    }
                }
            }
        });
        
        updateChartAndResults();
    }

    // --- æ›´æ–°å›¾è¡¨å’Œç»“æœ ---
    function updateChartAndResults() {
        const pKB = parseFloat(document.getElementById('pKB').value);
        const alpha = parseFloat(document.getElementById('alpha').value);
        const d11B_sw = parseFloat(document.getElementById('d11B_sw').value);
        const target_pH = parseFloat(document.getElementById('target_pH').value);

        if (isNaN(pKB) || isNaN(alpha) || isNaN(d11B_sw) || isNaN(target_pH)) {
            alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å€¼ï¼");
            return;
        }

        const newCurveData = generateCurveData(pKB, d11B_sw, alpha);
        
        boronChart.data.datasets[0].data = newCurveData.d11B_sw_line;
        boronChart.data.datasets[1].data = newCurveData.d11B_3_data;
        boronChart.data.datasets[2].data = newCurveData.d11B_4_data;

        const targetResult = calculateBoron(target_pH, pKB, d11B_sw, alpha);

        // ç›®æ ‡ç‚¹çš„æ•£ç‚¹å›¾å±‚
        boronChart.data.datasets[3].data = [
            { x: target_pH, y: targetResult.d11B_3, label: 'Bâ‚ƒ' },
            { x: target_pH, y: targetResult.d11B_4, label: 'Bâ‚„' }
        ];

        boronChart.update();

        // è¾“å‡ºç»“æœåˆ° HTML æ–‡æœ¬åŒºåŸŸ
        document.getElementById('output_pH').textContent = target_pH.toFixed(2);
        document.getElementById('d11B_3_result').textContent = targetResult.d11B_3.toFixed(4);
        document.getElementById('d11B_4_result').textContent = targetResult.d11B_4.toFixed(4);
    }

    window.onload = initChart;
</script>

</body>
</html>